# 确认对话框 UI 效果说明

## 修复前后对比

### 修复前 (BEFORE)
```
┌─────────────────────────────────────┐
│ 记账                      [全部确认] │
├─────────────────────────────────────┤
│                                     │
│  ┌───────────────────────────────┐ │
│  │ 📄 待确认交易                  │ │
│  ├───────────────────────────────┤ │
│  │ 金额: ¥50.00                  │ │
│  │ 分类: 餐饮                     │ │
│  │ 付款人: 张三                   │ │
│  │ [删除] [编辑] [确认]           │ │
│  └───────────────────────────────┘ │
│                                     │
│  ┌───────────────────────────────┐ │
│  │ 📄 待确认交易                  │ │
│  ├───────────────────────────────┤ │
│  │ 金额: ¥15.00                  │ │
│  │ 分类: 交通                     │ │
│  │ 付款人: 张三                   │ │
│  │ [删除] [编辑] [确认]           │ │
│  └───────────────────────────────┘ │
│                                     │
└─────────────────────────────────────┘

用户点击 [全部确认] 后：
❌ 直接确认所有交易，无任何提示
❌ 无法预览即将确认的内容
❌ 容易误操作
```

### 修复后 (AFTER)
```
┌─────────────────────────────────────┐
│ 记账                      [全部确认] │
├─────────────────────────────────────┤
│                                     │
│  ┌───────────────────────────────┐ │
│  │ 📄 待确认交易                  │ │
│  ├───────────────────────────────┤ │
│  │ 金额: ¥50.00                  │ │
│  │ 分类: 餐饮                     │ │
│  │ 付款人: 张三                   │ │
│  │ [删除] [编辑] [确认]           │ │
│  └───────────────────────────────┘ │
│                                     │
│  ┌───────────────────────────────┐ │
│  │ 📄 待确认交易                  │ │
│  ├───────────────────────────────┤ │
│  │ 金额: ¥15.00                  │ │
│  │ 分类: 交通                     │ │
│  │ 付款人: 张三                   │ │
│  │ [删除] [编辑] [确认]           │ │
│  └───────────────────────────────┘ │
│                                     │
└─────────────────────────────────────┘

用户点击 [全部确认] 后：
✅ 弹出确认对话框

    ┌───────────────────────────────┐
    │        确认入账                │
    ├───────────────────────────────┤
    │                               │
    │ • 餐饮: ¥50.00                │
    │ • 交通: ¥15.00                │
    │ • 购物: ¥120.00               │
    │                               │
    │ 总计: ¥185.00                 │
    │                               │
    ├───────────────────────────────┤
    │                               │
    │  [确认全部 3 笔交易]           │
    │                               │
    │  [取消]                       │
    │                               │
    └───────────────────────────────┘

✅ 显示所有交易的类别和金额
✅ 显示总金额
✅ 用户可以确认或取消
✅ 避免误操作
```

## 对话框组成部分

### 1. 标题
- 文字: "确认入账"
- 简洁明确地说明对话框用途

### 2. 消息内容
- **交易列表**: 每行显示一笔交易
  - 格式: `• 类别名: ¥金额`
  - 示例: `• 餐饮: ¥50.00`
  - 使用统一的货币格式化（2位小数）
  
- **总计**: 显示所有交易的总金额
  - 格式: `总计: ¥金额`
  - 示例: `总计: ¥185.00`
  - 前面空一行，便于区分

### 3. 操作按钮
- **确认按钮**: `确认全部 N 笔交易`
  - N 是待确认的交易数量
  - 点击后执行批量确认
  
- **取消按钮**: `取消`
  - 角色设为 `.cancel`
  - 点击后关闭对话框，不执行任何操作

## 技术实现

使用 SwiftUI 的 `confirmationDialog` 修饰符：

```swift
.confirmationDialog(
    "确认入账",                              // 标题
    isPresented: $showingConfirmAllDialog,  // 控制显示状态
    presenting: viewModel.pendingDrafts     // 传递待确认的交易列表
) { drafts in
    // 操作按钮
    Button("确认全部 \(drafts.count) 笔交易") {
        Task {
            await viewModel.confirmAllDrafts()
        }
    }
    Button("取消", role: .cancel) {}
} message: { drafts in
    // 消息内容
    let summary = drafts.map { draft in
        "• \(draft.categoryName): \(draft.amount.formatted(currency: "CNY"))"
    }.joined(separator: "\n")
    
    let total = drafts.reduce(Decimal.zero) { $0 + $1.amount }
    let totalText = "\n\n总计: \(total.formatted(currency: "CNY"))"
    
    Text(summary + totalText)
}
```

## 关键改进点

### 1. 显示类别信息 ✅
**问题**: 原始issue指出"用户确认框没有显示类别"
**解决**: 对话框明确显示每笔交易的类别名称

### 2. 一致的货币格式化 ✅
使用 `formatted(currency:)` 扩展方法，确保：
- 所有金额显示2位小数 (¥50.00，而非 ¥50.0)
- 与应用其他地方的格式保持一致

### 3. 用户友好的确认流程 ✅
- 二次确认，避免误操作
- 清晰显示将要确认的所有内容
- 提供取消选项

### 4. 符合iOS设计规范 ✅
- 使用原生 `confirmationDialog` 组件
- 遵循 iOS 人机界面指南
- 操作按钮清晰明确

## 总结

这个修复通过添加一个简单的确认对话框，解决了用户无法预览即将确认的交易内容的问题，特别是**确保显示了类别信息**。改动最小化（只修改了UI层），不影响业务逻辑，同时显著提升了用户体验。
